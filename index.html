<html ng-app="WebScanning">
<head>
    <title>Scan Documents with AngularJS</title>
	<script src="node_modules/angular/angular.min.js"> </script>
    <script src="Resources/dynamsoft.webtwain.initiate.js"> </script>
    <script src="Resources/dynamsoft.webtwain.config.js"> </script>
</head>

<body>
<div id="dwtcontrolContainer"></div>
<div ng-controller="twainControl">
	<button ng-click="acquireImage()">Scan</button>
	<button ng-click="uploadImage()">Upload</button>
</div>

<script>
	function twainControl($scope) {
		$scope.acquireImage = function() {
			var DWObject = Dynamsoft.WebTwainEnv.GetWebTwain('dwtcontrolContainer'); // Get the Dynamic Web TWAIN object that is embeded in the div with id 'dwtcontrolContainer'.
			DWObject.IfDisableSourceAfterAcquire = true;    // Source will be closed automatically after acquisition.
			DWObject.SelectSource();                        // Select a Data Source (a device like scanner) from the Data Source Manager.
			DWObject.OpenSource();                          // Open the source. You can set resolution, pixel type, etc. after this method. Please refer to the sample 'Scan' -> 'Custom Scan' for more info.
			DWObject.AcquireImage();
		};
		$scope.uploadImage = function() {
			var Digital = new Date();
			var uploadfilename = Digital.getMilliseconds(); // Uses milliseconds according to local time as the file name
			var DWObject = Dynamsoft.WebTwainEnv.GetWebTwain('dwtcontrolContainer'); // Get the Dynamic Web TWAIN object that is embeded in the div with id 'dwtcontrolContainer'.
			DWObject.HTTPPort = location.port;
			DWObject.HTTPUploadAllThroughPostAsPDF(strHTTPServer, strActionPage, uploadfilename + ".pdf", OnHttpUploadSuccess, OnHttpServerReturnedSomething);
		};
	}
	function OnHttpUploadSuccess() {
		console.log('successful');
	}

	function OnHttpServerReturnedSomething(errorCode, errorString, sHttpResponse) {
		console.log(errorString);
		var textFromServer = sHttpResponse;
	}
	var CurrentPathName = unescape(location.pathname);
	var CurrentPath = CurrentPathName.substring(0, CurrentPathName.lastIndexOf("/") + 1);
	var strHTTPServer = location.hostname;
	strActionPage = CurrentPath + 'action/csharp.aspx';
	var app = angular.module('WebScanning', []);
	app.controller('twainControl',twainControl);
</script>
</body>
</html>